<!doctype html>
<html lang="en-GB">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="../index.css">
    <link rel="stylesheet" href="lta-contracts-table.css">

    <link rel="icon" type="image/svg+xml" href="../logo-red.svg">
    <title>joofer.j/lta-rail-civil-contracts-list</title>

    <style type="text/css">
        html {
        	background: #000000;
        	font-family: Ubuntu;
        	font-weight: 500;
        	color: #FFFFFF;
        }
        			
        main {
            padding: 1.5rem;
        }
        
        h1 {
            margin-bottom: 1.5rem;
        }

		#tagFilters {
			display: flex;
			flex-wrap: wrap;
			gap: 0.5rem;
			margin-bottom: 1rem;
		}
		
		.tag-button {
			padding: 0.3rem 0.6rem;
			border: 1px solid var(--borderColor-muted, #444);
			border-radius: 5px;
			font-family: Ubuntu;
			background-color: var(--bgColor-muted, #222);
			cursor: pointer;
			font-size: 0.9rem;
			color: white;
			font-weight: 400;
		}
		
		.tag-button.active {
			font-family: Ubuntu;
			background-color: var(--bgColor-accent, #555);
			font-weight: 600;
		}
    </style>
</head>

<body>
    <div id="header">
        <span>joofer.j/lta-rail-civil-contracts-list</span>
        <div id="header-right">
            <a id="home" href="https://jooferj.github.io">Back to Menu</a>
        </div>
    </div>

    <main>
        <h1>LTA Rail Civil Contracts List</h1>
		
		<div id="tagFilters"></div>
		
        <div class="table-container">
            <table class="contracts-table" id="contractsTable">
                <thead>
                    <tr>
                        <th>Contract No.</th>
                        <th>Title</th>
                        <th>Description</th>
                        <th>Successful Tenderer</th>
                        <th>Notes</th>
						<th>Tags</th>
                    </tr>
                </thead>
				
                <tbody>
                    <!-- Table rows will be generated by JS -->
                </tbody>
            </table>
        </div>
    </main>

      <script> // TODO: DISPLAY TAG INFO IN TABLE
    let contractsData = [];
    let activeTags = new Set();

    async function loadContracts() {
      try {
		// Fetch JSON file
        const response = await fetch('lta-contracts-list.json');
        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
        contractsData = await response.json();

        // Sort contracts by contractNo (case-insensitive, natural order)
        contractsData.sort((a, b) =>
          a.contractNo.localeCompare(b.contractNo, undefined, { numeric: true, sensitivity: 'base' })
        );

        renderTagFilters();
        renderTable();
      } catch (error) {
        console.error('Error loading contracts:', error);
      }
    }

    function renderTagFilters() {
      const tagContainer = document.getElementById('tagFilters');
      tagContainer.innerHTML = '';

      // Collect all unique tags
      const allTags = [...new Set(contractsData.flatMap(c => c.tags || []))];
      allTags.sort();

      allTags.forEach(tag => {
        const button = document.createElement('button');
        button.textContent = tag;
        button.className = 'tag-button';
        button.addEventListener('click', () => toggleTag(tag, button));
        tagContainer.appendChild(button);
      });
    }

    function toggleTag(tag, button) {
      if (activeTags.has(tag)) {
        activeTags.delete(tag);
        button.classList.remove('active');
      } else {
        activeTags.add(tag);
        button.classList.add('active');
      }
      renderTable();
    }

    function renderTable() {
      const tbody = document.querySelector('#contractsTable tbody');
      tbody.innerHTML = '';

      contractsData.forEach(item => {
        if (activeTags.size > 0) {
          const hasTag = item.tags && item.tags.some(tag => activeTags.has(tag));
          if (!hasTag) return;
        }

        const row = document.createElement('tr');
		  if (item.contractNo !== "") {
			  row.innerHTML = `
			  <td>${item.contractNo || ''}</td>
			  <td>${item.title || ''}</td>
			  <td>${item.description || ''}</td>
			  <td>${item.tenderer || ''}</td>
			  <td>${item.notes || ''}</td>
			  <td>${(item.tags || []).join(', ')}</td>
			  `;
			  tbody.appendChild(row);
		  }
      });
    }

    loadContracts();
	  </script>
    </script>
</body>

</html>
